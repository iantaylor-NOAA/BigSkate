discard_comp_dir <- 'C:/SS/skates/bio/WCGOP_comps'
Length_Freq <- read.csv(file.path(discard_comp_dir,
                                  'BigSkate_WCGOP_Comps_V3_Length_Freq.csv'))
LF_Sample_Sizes <- read.csv(file.path(discard_comp_dir,
                                      'BigSkate_WCGOP_Comps_V3_LF_Sample_Sizes.csv'))

# make data frame for SS inputs with 0s for all comps
SSinput <- data.frame(year = sort(unique(Length_Freq$Year)),
                      month = 7, fleet = 1, sex = 3, part = 1,
                      Nsamp = NA)
lbins <- seq(5, 200, 5)
SSinput[,c(paste0("F", lbins), paste0("M", lbins))] <- 0

# loop over rows to fill in sample size and comps
for(irow in 1:nrow(SSinput)){
  y <- SSinput$year[irow]
  # get number of hauls for females and males combined
  Nhauls <- sum(LF_Sample_Sizes$N_unique_Hauls[LF_Sample_Sizes$Year == y &
                                                 LF_Sample_Sizes$Sex %in% c("F","M")])
  # get sample sizes
  Nfish.F <- sum(LF_Sample_Sizes$N_Fish[LF_Sample_Sizes$Year == y &
                                        LF_Sample_Sizes$Sex == "F"])
  Nfish.M <- sum(LF_Sample_Sizes$N_Fish[LF_Sample_Sizes$Year == y &
                                        LF_Sample_Sizes$Sex == "M"])
  Nfish <- Nfish.F + Nfish.M

  SSinput$Nsamp[irow] <- Nhauls
  
  for(len in lbins){
    for(sex in c("F","M")){
      colname <- paste0(sex, len)
      sex.ratio <- get(paste0("Nfish.", sex)) / Nfish
      prop <- Length_Freq$Prop.wghtd[Length_Freq$Year == y &
                                       Length_Freq$Sex == sex &
                                         Length_Freq$Lenbin == len]
      if(length(prop) > 0){
        SSinput[irow, colname] <- round(sex.ratio * prop, 4)
      }
    }
  }
}

options(width=600)
format(SSinput, sci=FALSE)
##   year month fleet sex part Nsamp F5 F10 F15    F20    F25    F30    F35    F40    F45    F50    F55    F60    F65    F70    F75    F80    F85    F90    F95   F100   F105   F110   F115   F120   F125   F130   F135   F140   F145 F150 F155 F160 F165 F170 F175   F180 F185 F190 F195 F200 M5 M10 M15    M20    M25    M30    M35    M40    M45    M50    M55    M60    M65    M70    M75    M80    M85    M90    M95   M100   M105   M110   M115   M120   M125   M130 M135 M140 M145 M150 M155 M160 M165 M170 M175 M180 M185 M190 M195 M200
## 1 2010     7     1   3    1   146  0   0   0 0.0212 0.0407 0.0455 0.0643 0.0780 0.0690 0.0508 0.1044 0.0171 0.0066 0.0079 0.0009 0.0025 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000    0    0    0    0    0    0 0.0000    0    0    0    0  0   0   0 0.0110 0.0265 0.0916 0.0397 0.0889 0.0397 0.0991 0.0393 0.0157 0.0238 0.0109 0.0038 0.0000 0.0000 0.0000 0.0000 0.0005 0.0000 0.0005 0.0000 0.0000 0.0000 0.0000    0    0    0    0    0    0    0    0    0    0    0    0    0    0
## 2 2011     7     1   3    1   534  0   0   0 0.0285 0.0234 0.0425 0.0642 0.1162 0.1051 0.0672 0.0563 0.0231 0.0060 0.0033 0.0008 0.0001 0.0003 0.0001 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0001 0.0000 0.0000    0    0    0    0    0    0 0.0000    0    0    0    0  0   0   0 0.0138 0.0195 0.0351 0.0725 0.0838 0.0623 0.0717 0.0525 0.0298 0.0113 0.0042 0.0022 0.0019 0.0009 0.0004 0.0007 0.0000 0.0000 0.0000 0.0002 0.0000 0.0001 0.0000    0    0    0    0    0    0    0    0    0    0    0    0    0    0
## 3 2012     7     1   3    1   539  0   0   0 0.0365 0.0506 0.0547 0.0829 0.0624 0.0776 0.0517 0.0457 0.0212 0.0132 0.0057 0.0019 0.0002 0.0003 0.0005 0.0001 0.0004 0.0004 0.0001 0.0000 0.0000 0.0000 0.0001 0.0000 0.0001 0.0000    0    0    0    0    0    0 0.0000    0    0    0    0  0   0   0 0.0289 0.0331 0.0523 0.0553 0.0805 0.0725 0.0741 0.0426 0.0283 0.0133 0.0066 0.0026 0.0021 0.0008 0.0000 0.0000 0.0000 0.0005 0.0002 0.0001 0.0001 0.0000 0.0000    0    0    0    0    0    0    0    0    0    0    0    0    0    0
## 4 2013     7     1   3    1   436  0   0   0 0.0017 0.0188 0.0417 0.0339 0.0344 0.0637 0.0729 0.1046 0.0779 0.0509 0.0216 0.0197 0.0042 0.0087 0.0053 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000    0    0    0    0    0    0 0.0000    0    0    0    0  0   0   0 0.0050 0.0141 0.0245 0.0375 0.0443 0.0256 0.0777 0.0594 0.0511 0.0490 0.0300 0.0118 0.0048 0.0032 0.0003 0.0002 0.0004 0.0000 0.0002 0.0000 0.0000 0.0000 0.0009    0    0    0    0    0    0    0    0    0    0    0    0    0    0
## 5 2014     7     1   3    1   671  0   0   0 0.0059 0.0032 0.0068 0.0131 0.0255 0.0610 0.0895 0.1385 0.1216 0.0798 0.0376 0.0094 0.0023 0.0004 0.0002 0.0003 0.0000 0.0001 0.0000 0.0001 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000    0    0    0    0    0    0 0.0001    0    0    0    0  0   0   0 0.0011 0.0031 0.0123 0.0101 0.0298 0.0507 0.0487 0.0856 0.0787 0.0614 0.0173 0.0034 0.0017 0.0001 0.0000 0.0000 0.0003 0.0001 0.0001 0.0001 0.0000 0.0000 0.0000    0    0    0    0    0    0    0    0    0    0    0    0    0    0
## 6 2015     7     1   3    1   687  0   0   0 0.0020 0.0084 0.0162 0.0375 0.0711 0.0776 0.0831 0.0673 0.0710 0.0572 0.0259 0.0110 0.0030 0.0006 0.0007 0.0002 0.0000 0.0000 0.0000 0.0002 0.0001 0.0000 0.0000 0.0000 0.0002 0.0000    0    0    0    0    0    0 0.0000    0    0    0    0  0   0   0 0.0067 0.0077 0.0308 0.0226 0.0454 0.0753 0.0630 0.0671 0.0527 0.0399 0.0361 0.0075 0.0054 0.0029 0.0025 0.0000 0.0003 0.0004 0.0003 0.0000 0.0001 0.0000 0.0000    0    0    0    0    0    0    0    0    0    0    0    0    0    0
## 7 2016     7     1   3    1   651  0   0   0 0.0063 0.0183 0.0227 0.0279 0.0195 0.0373 0.0403 0.0741 0.0793 0.0638 0.0368 0.0118 0.0038 0.0017 0.0033 0.0002 0.0001 0.0001 0.0000 0.0001 0.0000 0.0001 0.0001 0.0001 0.0000 0.0000    0    0    0    0    0    0 0.0000    0    0    0    0  0   0   0 0.0179 0.0380 0.0413 0.0383 0.0567 0.0361 0.0725 0.0622 0.0653 0.0466 0.0444 0.0143 0.0073 0.0050 0.0007 0.0000 0.0011 0.0014 0.0015 0.0007 0.0004 0.0005 0.0000    0    0    0    0    0    0    0    0    0    0    0    0    0    0
## 8 2017     7     1   3    1   507  0   0   0 0.0111 0.0085 0.0265 0.0448 0.0485 0.0569 0.0706 0.0468 0.0664 0.0585 0.0323 0.0095 0.0099 0.0033 0.0003 0.0007 0.0004 0.0000 0.0009 0.0001 0.0000 0.0000 0.0020 0.0009 0.0000 0.0009    0    0    0    0    0    0 0.0000    0    0    0    0  0   0   0 0.0077 0.0237 0.0182 0.0335 0.0727 0.0487 0.0460 0.0384 0.0564 0.0374 0.0538 0.0304 0.0134 0.0040 0.0038 0.0020 0.0002 0.0033 0.0021 0.0010 0.0032 0.0000 0.0000    0    0    0    0    0    0    0    0    0    0    0    0    0    0



### read average weight worksheet
Avg_Weight <- read.csv(file.path(discard_comp_dir,
                                 'BigSkate_WCGOP_Comps_V3_Avg_Weight.csv'))
# remove non-trawl
Avg_Weight <- Avg_Weight[Avg_Weight$Gear == "Trawl",]

plot(Avg_Weight$Year, Avg_Weight$AVG_WEIGHT.Mean, type='o', ylim=c(0,10))
points(Avg_Weight$Year, Avg_Weight$AVG_WEIGHT.Median, type='o', col=2)
points(Avg_Weight$Year, Avg_Weight$Wghtd.AVG_W, type='o', col=4)


